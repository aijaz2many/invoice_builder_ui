<div class="admin-container">
    <div class="container">
        <div class="page-header">
            <div class="header-left">
                <h2>{{ showAll ? 'All Templates' : 'Pending Templates' }}</h2>
                <p>{{ showAll ? 'Manage all business templates in the system.' : 'Manage user-submitted images that need
                    PDF conversion.' }}</p>
            </div>
            <div class="header-actions">
                <button class="btn btn-outline" (click)="toggleShowAll()">
                    <svg *ngIf="!showAll" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                    <svg *ngIf="showAll" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path
                            d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z">
                        </path>
                        <line x1="12" y1="9" x2="12" y2="13"></line>
                        <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    {{ showAll ? 'Show Pending Only' : 'Show All Businesses' }}
                </button>
                <div *ngIf="pendingCount > 0" class="pending-summary">
                    <span class="count">{{ pendingCount }}</span>
                    <span class="label">Templates Pending</span>
                </div>
                <button class="btn btn-outline" (click)="loadAllBusinesses()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M23 4v6h-6"></path>
                        <path d="M1 20v-6h6"></path>
                        <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
                    </svg>
                    Refresh
                </button>
            </div>
        </div>

        <div *ngIf="successMessage" class="banner success-banner">
            {{ successMessage }}
        </div>
        <div *ngIf="errorMessage" class="banner error-banner">
            {{ errorMessage }}
        </div>

        <!-- Quick Upload Section -->
        <div class="quick-upload-card" *ngIf="!isLoading && allBusinesses.length > 0">
            <div class="card-header-compact">
                <div class="title-with-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="title-icon">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                    <h3 class="card-title">Quick Template Process</h3>
                </div>
                <p class="card-subtitle">Search for a business and upload the converted PDF template instantly.</p>
            </div>

            <div class="upload-action-row">
                <div class="step-group">
                    <div class="step-badge">1</div>
                    <div class="control-wrapper">
                        <label>Select Business</label>
                        <div class="searchable-container">
                            <input type="text" list="businessList" class="custom-input"
                                placeholder="Type business name or ID..." (change)="onQuickSearchChange($event)"
                                [value]="getQuickBusinessName()">
                            <datalist id="businessList">
                                <option *ngFor="let b of allBusinesses"
                                    [value]="b.businessName + ' (ID: ' + b.businessId + ')'">
                                    {{ b.templateStatus }}
                                </option>
                            </datalist>
                        </div>
                    </div>
                </div>

                <div class="step-connector">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                        <polyline points="12 5 19 12 12 19"></polyline>
                    </svg>
                </div>

                <div class="step-group">
                    <div class="step-badge">2</div>
                    <div class="control-wrapper">
                        <label>Upload Processed PDF</label>
                        <label [for]="'quick-file'" class="premium-upload-btn"
                            [class.disabled]="!quickBusinessId || isUploading">
                            <svg *ngIf="!isUploading" xmlns="http://www.w3.org/2000/svg" width="18" height="18"
                                viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                stroke-linecap="round" stroke-linejoin="round" class="btn-icon">
                                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                <polyline points="17 8 12 3 7 8"></polyline>
                                <line x1="12" y1="3" x2="12" y2="15"></line>
                            </svg>
                            <span *ngIf="isUploading" class="upload-spinner"></span>
                            <span class="btn-text">
                                {{ (isUploading && selectedBusinessId === quickBusinessId) ? 'Uploading PDF...' :
                                'Select & Upload PDF' }}
                            </span>
                            <input type="file" id="quick-file" (change)="onQuickFileSelected($event)" accept=".pdf"
                                hidden [disabled]="!quickBusinessId">
                        </label>
                    </div>
                </div>
            </div>
        </div>


        <div class="card table-card">
            <div *ngIf="isLoading" class="loading-state">
                <div class="spinner"></div>
                <p>Loading businesses...</p>
            </div>

            <table *ngIf="!isLoading">
                <thead>
                    <tr>
                        <th>Business Name</th>
                        <th>Status</th>
                        <th>Created On</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let b of businesses" [class.highlight-pending]="b.templateStatus === 'PENDING'">
                        <td>
                            <div class="business-info">
                                <strong>{{ b.businessName }}</strong>
                                <span>ID: {{ b.businessId }}</span>
                            </div>
                        </td>
                        <td>
                            <span class="status-badge" [ngClass]="getStatusClass(b.templateStatus)">
                                {{ b.templateStatus || 'MISSING' }}
                            </span>
                        </td>
                        <td>{{ $any(b).createdOn | date:'mediumDate' }}</td>
                        <td>
                            <div class="action-buttons">
                                <button *ngIf="b.templateStatus === 'PENDING'" class="btn btn-sm btn-primary"
                                    (click)="viewRawTemplate(b.businessId)">
                                    View Raw Image
                                </button>

                                <label [for]="'file-' + b.businessId" class="btn btn-sm btn-outline btn-upload"
                                    [class.disabled]="isUploading && selectedBusinessId === b.businessId">
                                    {{ (isUploading && selectedBusinessId === b.businessId) ? 'Uploading...' : 'Upload
                                    Processed PDF' }}
                                    <input type="file" [id]="'file-' + b.businessId"
                                        (change)="onFileSelected($event, b.businessId)" accept=".pdf" hidden>
                                </label>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>

            <div *ngIf="!isLoading && businesses.length === 0" class="empty-state">
                <p>No businesses found.</p>
            </div>
        </div>
    </div>
</div>